---
marp: true
theme: default
paginate: true
backgroundColor: #1a1a2e
color: #eaeaea
style: |
  section {
    font-family: 'Segoe UI', Arial, sans-serif;
  }
  h1 {
    color: #00d4ff;
  }
  h2 {
    color: #ff6b6b;
  }
  code {
    background-color: #16213e;
  }
  table {
    font-size: 0.8em;
  }
---

# RevPay
## Secure Digital Banking System

### Oracle Database Implementation

**Developed By:** Karthik  
ğŸ“§ karthik1237t@gmail.com

---

# ğŸ“Œ Project Overview

## RevPay - Digital Banking System

**A secure console-based banking application**

### Key Features:
- ğŸ’³ Wallet Management & Money Transfers
- ğŸ“„ Invoice Generation (Business Users)
- ğŸ’° Loan Management
- ğŸ” Secure Transaction Handling
- ğŸ‘¥ Role-based Access Control

---

# ğŸ› ï¸ Tools & Environment

| Tool | Purpose |
|------|---------|
| **IntelliJ IDEA** | Integrated Development Environment |
| **Oracle RDBMS** | Relational Database Management System |
| **SQL Developer** | Oracle Database Administration |
| **Maven** | Build and Dependency Management |
| **JDBC** | Java Database Connectivity |

---

# ğŸ‘¤ Database User Creation

```sql
-- Connect as SYSDBA
CONN / AS SYSDBA;

-- Create Application User
CREATE USER revpay_user IDENTIFIED BY "RevPay123"
    DEFAULT TABLESPACE users
    TEMPORARY TABLESPACE temp
    QUOTA UNLIMITED ON users;

-- Grant Privileges
GRANT CONNECT, RESOURCE TO revpay_user;
GRANT CREATE SESSION, CREATE TABLE TO revpay_user;
GRANT CREATE SEQUENCE, CREATE TRIGGER TO revpay_user;
GRANT CREATE PROCEDURE, CREATE VIEW TO revpay_user;
```

---

# ğŸ“Š Schema Objects - ER Diagram

### Core Entities & Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     1:1      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USERS  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ WALLETS â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1:N
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚TRANSACTIONS â”‚    â”‚   INVOICES   â”‚    â”‚  LOANS  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**8 Tables:** Users, Wallets, Transactions, Payment Methods, Business Profiles, Invoices, Loans, Payment Requests

---

# ğŸ“ Schema Objects - Tables (1/2)

```sql
-- USERS TABLE
CREATE TABLE users (
    user_id       NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    email         VARCHAR2(255) NOT NULL UNIQUE,
    password_hash VARCHAR2(255) NOT NULL,
    full_name     VARCHAR2(100),
    role          VARCHAR2(20) DEFAULT 'PERSONAL' NOT NULL
);

-- WALLETS TABLE
CREATE TABLE wallets (
    user_id   NUMBER PRIMARY KEY,
    balance   NUMBER(15,2) DEFAULT 0.00,
    CONSTRAINT fk_wallet_user FOREIGN KEY (user_id)
        REFERENCES users(user_id) ON DELETE CASCADE
);
```

---

# ğŸ“ Schema Objects - Tables (2/2)

```sql
-- TRANSACTIONS TABLE
CREATE TABLE transactions (
    transaction_id    NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    sender_id         NUMBER,
    receiver_id       NUMBER,
    amount            NUMBER(15,2) NOT NULL,
    transaction_type  VARCHAR2(50) NOT NULL,
    status            VARCHAR2(50) NOT NULL,
    timestamp         TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_trans_sender FOREIGN KEY (sender_id)
        REFERENCES users(user_id) ON DELETE SET NULL,
    CONSTRAINT fk_trans_receiver FOREIGN KEY (receiver_id)
        REFERENCES users(user_id) ON DELETE SET NULL
);
```

---

# ğŸ“‹ Master Tables Population

```sql
-- ROLE MASTER TABLE
CREATE TABLE roles_master (
    role_id     NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    role_name   VARCHAR2(50) NOT NULL UNIQUE,
    description VARCHAR2(255)
);

INSERT INTO roles_master (role_name, description) VALUES 
    ('PERSONAL', 'Personal/Individual User Account');
INSERT INTO roles_master (role_name, description) VALUES 
    ('BUSINESS', 'Business/Merchant User Account');
INSERT INTO roles_master (role_name, description) VALUES 
    ('ADMIN', 'System Administrator Account');

COMMIT;
```

---

# ğŸ“¦ PL/SQL Package - Specification

```sql
CREATE OR REPLACE PACKAGE pkg_revpay AS
    -- User Management
    PROCEDURE sp_register_user(
        p_email IN VARCHAR2, p_password_hash IN VARCHAR2,
        p_full_name IN VARCHAR2, p_role IN VARCHAR2,
        p_user_id OUT NUMBER
    );
    
    -- Wallet Operations
    PROCEDURE sp_transfer_money(
        p_sender_id IN NUMBER, p_receiver_id IN NUMBER,
        p_amount IN NUMBER, p_trans_id OUT NUMBER
    );
    
    -- Functions
    FUNCTION fn_get_user_balance(p_user_id IN NUMBER) RETURN NUMBER;
    FUNCTION fn_authenticate_user(p_email IN VARCHAR2, 
                                  p_password IN VARCHAR2) RETURN NUMBER;
END pkg_revpay;
/
```

---

# âš™ï¸ Stored Procedures

```sql
PROCEDURE sp_transfer_money(
    p_sender_id IN NUMBER, p_receiver_id IN NUMBER,
    p_amount IN NUMBER, p_trans_id OUT NUMBER
) AS
    v_sender_balance NUMBER;
BEGIN
    -- Lock sender's wallet
    SELECT balance INTO v_sender_balance
    FROM wallets WHERE user_id = p_sender_id FOR UPDATE;
    
    IF v_sender_balance < p_amount THEN
        RAISE_APPLICATION_ERROR(-20004, 'Insufficient balance');
    END IF;
    
    -- Deduct from sender, Credit to receiver
    UPDATE wallets SET balance = balance - p_amount 
        WHERE user_id = p_sender_id;
    UPDATE wallets SET balance = balance + p_amount 
        WHERE user_id = p_receiver_id;
    
    INSERT INTO transactions (...) VALUES (...) 
        RETURNING transaction_id INTO p_trans_id;
    COMMIT;
END;
```

---

# ğŸ”§ Functions

```sql
-- GET USER BALANCE
FUNCTION fn_get_user_balance(p_user_id IN NUMBER) 
RETURN NUMBER AS
    v_balance NUMBER;
BEGIN
    SELECT balance INTO v_balance
    FROM wallets WHERE user_id = p_user_id;
    RETURN v_balance;
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN NULL;
END fn_get_user_balance;

-- AUTHENTICATE USER
FUNCTION fn_authenticate_user(p_email IN VARCHAR2, 
                              p_password IN VARCHAR2) 
RETURN NUMBER AS
    v_user_id NUMBER;
BEGIN
    SELECT user_id INTO v_user_id FROM users 
    WHERE email = p_email AND password_hash = p_password;
    RETURN v_user_id;
EXCEPTION
    WHEN NO_DATA_FOUND THEN RETURN -1;
END;
```

---

# âš¡ Database Triggers

```sql
-- AUTO-CREATE WALLET ON USER REGISTRATION
CREATE OR REPLACE TRIGGER trg_create_wallet
AFTER INSERT ON users
FOR EACH ROW
BEGIN
    INSERT INTO wallets (user_id, balance) VALUES (:NEW.user_id, 0.00);
END;
/

-- PREVENT NEGATIVE BALANCE
CREATE OR REPLACE TRIGGER trg_prevent_negative_balance
BEFORE UPDATE ON wallets
FOR EACH ROW
BEGIN
    IF :NEW.balance < 0 THEN
        RAISE_APPLICATION_ERROR(-20005, 
            'Wallet balance cannot be negative');
    END IF;
END;
/
```

---

# âš¡ More Triggers

```sql
-- AUDIT LOG TRIGGER
CREATE OR REPLACE TRIGGER trg_transaction_audit
AFTER INSERT ON transactions
FOR EACH ROW
BEGIN
    INSERT INTO audit_log (table_name, operation, new_values)
    VALUES ('TRANSACTIONS', 'INSERT', 
        'ID: ' || :NEW.transaction_id || 
        ', Amount: ' || :NEW.amount);
END;
/

-- VALIDATE TRANSACTION
CREATE OR REPLACE TRIGGER trg_validate_transaction
BEFORE INSERT ON transactions
FOR EACH ROW
BEGIN
    IF :NEW.amount <= 0 THEN
        RAISE_APPLICATION_ERROR(-20006, 'Amount must be positive');
    END IF;
END;
/
```

---

# ğŸ”’ Constraints Summary

| Type | Table | Column(s) | Description |
|------|-------|-----------|-------------|
| **PRIMARY KEY** | All | *_id | Unique identifier |
| **FOREIGN KEY** | wallets | user_id | References users |
| **FOREIGN KEY** | transactions | sender_id, receiver_id | References users |
| **UNIQUE** | users | email | No duplicate emails |
| **NOT NULL** | users | email, password_hash | Required fields |
| **DEFAULT** | wallets | balance | Default 0.00 |
| **CHECK** | wallets | balance >= 0 | No negative balance |

---

# ğŸ”„ Transaction Management

## ACID Properties Ensured

| Property | Implementation |
|----------|----------------|
| **Atomicity** | All operations in single transaction |
| **Consistency** | Triggers enforce business rules |
| **Isolation** | FOR UPDATE locks prevent races |
| **Durability** | COMMIT ensures permanent storage |

```sql
BEGIN
    SELECT balance FROM wallets WHERE user_id = ? FOR UPDATE;
    UPDATE wallets SET balance = balance - amount WHERE user_id = ?;
    UPDATE wallets SET balance = balance + amount WHERE user_id = ?;
    INSERT INTO transactions (...) VALUES (...);
    COMMIT;
EXCEPTION
    WHEN OTHERS THEN ROLLBACK; RAISE;
END;
```

---

# ğŸ’» Java Integration (JDBC)

```java
// Calling Stored Procedure
public int registerUser(User user) throws SQLException {
    String sql = "{CALL pkg_revpay.sp_register_user(?,?,?,?,?)}";
    
    try (CallableStatement cs = connection.prepareCall(sql)) {
        cs.setString(1, user.getEmail());
        cs.setString(2, SecurityUtil.hashPassword(user.getPassword()));
        cs.setString(3, user.getFullName());
        cs.setString(4, user.getRole().toString());
        cs.registerOutParameter(5, Types.INTEGER);
        
        cs.execute();
        return cs.getInt(5); // Returns user_id
    }
}
```

---

# ğŸ” Security Considerations

### 1. Password Security
- Passwords hashed using **BCrypt**
- Never store plain text passwords

### 2. SQL Injection Prevention
- Use **PreparedStatements** in JDBC
- Use **bind variables** in PL/SQL

### 3. Access Control
```sql
GRANT EXECUTE ON pkg_revpay TO revpay_user;
REVOKE INSERT, UPDATE, DELETE ON users FROM revpay_readonly;
```

---

# âœ… Summary

### What We Implemented:

| Component | Status |
|-----------|--------|
| Oracle Database Users | âœ… |
| Schema Objects (8 Tables) | âœ… |
| Master Tables | âœ… |
| PL/SQL Package | âœ… |
| Stored Procedures | âœ… |
| Functions | âœ… |
| Triggers | âœ… |
| Constraints | âœ… |
| Transaction Management | âœ… |

---

# ğŸ™ Thank You!

## Questions?

### RevPay - Secure Digital Banking System

**Technologies:**
- IntelliJ IDEA
- Oracle RDBMS
- Java (JDBC)
- Maven

---

**Developed By:** Karthik  
ğŸ“§ karthik1237t@gmail.com
